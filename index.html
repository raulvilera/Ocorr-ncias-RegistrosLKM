<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 - Cadastro de Ocorrências</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #001f3f;
        }

        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 350px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #001f3f;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .login-btn {
            width: 100%;
            padding: 10px;
            background-color: #001f3f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .login-btn:hover {
            background-color: #003366;
        }

        .app-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #001f3f;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .content {
            flex: 1;
            padding: 20px;
        }

        /* Estilos específicos para a interface de gestão */
        .gestao-container {
            display: none;
        }

        .form-title {
            background-color: #001f3f;
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .gestao-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }

        .form-field {
            flex: 1;
            min-width: 200px;
        }

        .form-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-field input, .form-field select, .form-field textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-field textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            background-color: #001f3f;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .success-message {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            display: none;
            border-radius: 4px;
        }

        /* Estilos específicos para a interface do professor */
        .professor-container {
            display: none;
        }

        .occurrence-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: #001f3f;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-item input {
            margin-right: 5px;
        }

        .hidden {
            display: none;
        }

        /* Estilos para autocomplete */
        .autocomplete {
            position: relative;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        /* Estilos para popup de seleção de alunos */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .popup-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .student-list {
            margin: 15px 0;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .student-item:hover {
            background-color: #f5f5f5;
        }

        .popup-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .popup-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .popup-btn.confirm {
            background-color: #001f3f;
            color: white;
        }

        .popup-btn.cancel {
            background-color: #ccc;
        }

        /* Estilos para o botão de download do PDF */
        .download-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-btn:hover {
            background-color: #45a049;
        }

        /* Estilos para campos redimensionáveis */
        .resizable-field {
            min-width: 200px;
            max-width: 100%;
            resize: both;
            overflow: auto;
        }

        /* Estilos para informações expandidas */
        .field-info {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
            max-width: 300px;
        }

        .form-field {
            position: relative;
        }

        .form-field:hover .field-info {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2>2025 - Cadastro de Ocorrências</h2>
            <div class="form-group">
                <label for="email">E-mail:</label>
                <input type="email" id="email" placeholder="Digite seu e-mail">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha">
            </div>
            <button class="login-btn" onclick="login()">Entrar</button>
        </div>
    </div>

    <!-- Container principal da aplicação -->
    <div class="app-container" id="appContainer">
        <div class="header">
            <h1>2025 - Cadastro de Ocorrências</h1>
            <div class="user-info">
                <span id="userName">Usuário</span>
                <button class="logout-btn" onclick="logout()">Sair</button>
                <button class="download-btn" id="downloadPdfBtn" style="display: none;" onclick="generatePDF()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8.5 1.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V2a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 6.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707V10.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2z"/>
                        <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                    </svg>
                    Baixar PDF
                </button>
            </div>
        </div>

        <!-- Interface de Gestão -->
        <div class="content gestao-container" id="gestaoContainer">
            <div class="form-title">
                CADASTRO DE OCORRÊNCIAS - GESTÃO
            </div>
            <div class="gestao-form">
                <div class="form-row">
                    <div class="form-field autocomplete">
                        <label for="aluno">ALUNO:</label>
                        <input type="text" id="aluno" class="resizable-field" oninput="searchStudents(this.value)" onclick="showFieldInfo('info-aluno', event)">
                        <div class="field-info" id="info-aluno">Digite o nome do aluno para buscar automaticamente</div>
                        <div id="autocomplete-list" class="autocomplete-items"></div>
                    </div>
                    <div class="form-field">
                        <label for="serie">SÉRIE/TURMA:</label>
                        <input type="text" id="serie" class="resizable-field" readonly onclick="showFieldInfo('info-serie', event)">
                        <div class="field-info" id="info-serie">Série/turma do aluno (preenchido automaticamente)</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="professor">PROFESSOR:</label>
                        <input type="text" id="professor" class="resizable-field" onclick="showFieldInfo('info-professor', event)">
                        <div class="field-info" id="info-professor">Nome do professor responsável</div>
                    </div>
                    <div class="form-field">
                        <label for="ra">RA:</label>
                        <input type="text" id="ra" class="resizable-field" readonly onclick="showFieldInfo('info-ra', event)">
                        <div class="field-info" id="info-ra">Registro do Aluno (preenchido automaticamente)</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="disciplina">DISCIPLINA:</label>
                        <input type="text" id="disciplina" class="resizable-field" onclick="showFieldInfo('info-disciplina', event)">
                        <div class="field-info" id="info-disciplina">Disciplina relacionada à ocorrência</div>
                    </div>
                    <div class="form-field">
                        <label for="classificacao">CLASSIFICAÇÃO:</label>
                        <select id="classificacao" class="resizable-field" onchange="toggleSuspensionField()" onclick="showFieldInfo('info-classificacao', event)">
                            <option value="">Selecione</option>
                            <option value="OCORRÊNCIA">OCORRÊNCIA</option>
                            <option value="SUSPENSÃO">SUSPENSÃO</option>
                        </select>
                        <div class="field-info" id="info-classificacao">Selecione o tipo de ocorrência</div>
                    </div>
                </div>
                <div class="form-row" id="suspensionField" style="display: none;">
                    <div class="form-field">
                        <label for="dataRetorno">DATA DE RETORNO:</label>
                        <input type="date" id="dataRetorno" class="resizable-field" onclick="showFieldInfo('info-dataRetorno', event)">
                        <div class="field-info" id="info-dataRetorno">Data de retorno para suspensões</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="descricao">DESCRIÇÃO:</label>
                        <textarea id="descricao" class="resizable-field" onclick="showFieldInfo('info-descricao', event)"></textarea>
                        <div class="field-info" id="info-descricao">Descreva detalhadamente a ocorrência</div>
                    </div>
                </div>
                <button class="submit-btn" onclick="cadastrarOcorrencia()">Cadastrar Ocorrência</button>
                
                <div class="success-message" id="successMessage">
                    OCORRÊNCIA REGISTRADA COM SUCESSO
                </div>
            </div>
        </div>

        <!-- Interface do Professor -->
        <div class="content professor-container" id="professorContainer">
            <div class="form-title">
                REGISTRO DE OCORRÊNCIAS - PROFESSOR
            </div>
            <div class="occurrence-form">
                <div class="form-section">
                    <h3>1. IDENTIFICAÇÃO DA OCORRÊNCIA</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="professorNome">NOME DO PROFESSOR:</label>
                            <select id="professorNome" class="resizable-field" onclick="showFieldInfo('info-professorNome', event)"></select>
                            <div class="field-info" id="info-professorNome">Selecione seu nome na lista</div>
                        </div>
                        <div class="form-field">
                            <label for="professorTurma">TURMA:</label>
                            <select id="professorTurma" class="resizable-field" onchange="loadClassStudents()" onclick="showFieldInfo('info-professorTurma', event)"></select>
                            <div class="field-info" id="info-professorTurma">Selecione a turma</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="alunoOcorrencia">ALUNO(S) ENVOLVIDO(S):</label>
                            <input type="text" id="alunoOcorrencia" class="resizable-field" readonly onclick="showStudentsPopup()">
                            <div class="field-info" id="info-alunoOcorrencia">Clique para selecionar os alunos envolvidos</div>
                        </div>
                        <div class="form-field">
                            <label for="dataOcorrencia">DATA DA OCORRÊNCIA:</label>
                            <input type="date" id="dataOcorrencia" class="resizable-field" onclick="showFieldInfo('info-dataOcorrencia', event)">
                            <div class="field-info" id="info-dataOcorrencia">Data em que a ocorrência aconteceu</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>2. TIPO DE IRREGULARIDADE</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade1" name="irregularidades" value="Indisciplina">
                            <label for="irregularidade1">Indisciplina</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade2" name="irregularidades" value="Uso de celular">
                            <label for="irregularidade2">Uso de celular</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade3" name="irregularidades" value="Conversa paralela">
                            <label for="irregularidade3">Conversa paralela</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade4" name="irregularidades" value="Agressão verbal">
                            <label for="irregularidade4">Agressão verbal</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade5" name="irregularidades" value="Agressão física">
                            <label for="irregularidade5">Agressão física</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade6" name="irregularidades" value="Danos ao patrimônio">
                            <label for="irregularidade6">Danos ao patrimônio</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade7" name="irregularidades" value="Outros">
                            <label for="irregularidade7">Outros</label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>3. DESCRIÇÃO DA OCORRÊNCIA</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <textarea id="descricaoOcorrencia" class="resizable-field" placeholder="Descreva detalhadamente a ocorrência..." onclick="showFieldInfo('info-descricaoOcorrencia', event)"></textarea>
                            <div class="field-info" id="info-descricaoOcorrencia">Descreva detalhadamente o ocorrido</div>
                        </div>
                    </div>
                </div>

                <button class="submit-btn" onclick="registrarOcorrenciaProfessor()">Registrar Ocorrência</button>
                
                <div class="success-message" id="professorSuccessMessage">
                    OCORRÊNCIA REGISTRADA COM SUCESSO
                </div>
            </div>
        </div>
    </div>

    <!-- Popup para seleção de alunos -->
    <div class="popup-overlay hidden" id="studentsPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h3>Selecionar Alunos</h3>
                <button class="popup-close" onclick="closeStudentsPopup()">&times;</button>
            </div>
            <div class="student-list" id="studentList">
                <!-- Lista de alunos será preenchida dinamicamente -->
            </div>
            <div class="popup-footer">
                <button class="popup-btn cancel" onclick="closeStudentsPopup()">Cancelar</button>
                <button class="popup-btn confirm" onclick="confirmStudentsSelection()">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // URLs do Google Apps Script Web App
        const SPREADSHEET_ID = '1u7qMsMHkZT47OZdar5qvshQDRA8XJrLgDjAZVOViAio';
        const SCRIPT_URL = 'https://script.google.com/macros/s/SEU_SCRIPT_ID/exec';

        // Mapeamento de turmas e intervalos
        function _getClassRanges() {
            return {
                "6° ANO A MANHA": "C3:C46",
                "6° ANO B MANHA": "H3:H46",
                "6° ANO C MANHA": "M3:M46",
                "6° ANO D MANHA": "R3:R46",
                "6° ANO E TARDE": "W3:W46",
                "6° ANO F TARDE": "AB3:AB46",
                "7° ANO A TARDE": "AG3:AG46",
                "7° ANO B TARDE": "AL3:AL46",
                "7° ANO C TARDE": "AQ3:AQ46",
                "7° ANO D TARDE": "AV3:AV46",
                "7° ANO E TARDE": "BA3:BA46",
                "7° ANO F TARDE": "BF3:BF46",
                "8° ANO A TARDE": "BK3:BK46",
                "8° ANO B TARDE": "BP3:BP46",
                "8° ANO C TARDE": "BU3:BU46",
                "8° ANO D TARDE": "BZ3:BZ46",
                "9° ANO A TARDE": "CE3:CE46",
                "9° ANO B TARDE": "CJ3:CJ46",
                "9° ANO C TARDE": "CO3:CO46",
                "9° ANO D TARDE": "CT3:CT46",
                "1ª SERIE A MANHA": "CY3:CY46",
                "1ª SERIE B MANHA": "DD3:DD46",
                "1ª SERIE C MANHA": "DI3:DI46",
                "1ª SERIE D MANHA": "DN3:DN46",
                "1ª SERIE E MANHA": "DS3:DS46",
                "1ª SERIE F MANHA": "DX3:DX46",
                "1ª SERIE G TARDE": "EC3:EC46",
                "1ª SERIE H NOITE": "EH3:EH46",
                "1ª SERIE I NOITE": "EM3:EM46",
                "2ª SERIE A MANHA": "ER3:ER46",
                "2ª SERIE B MANHA": "EW3:EW46",
                "2ª SERIE C MANHA": "FB3:FB46",
                "2ª SERIE D MANHA": "FG3:FG46",
                "2ª SERIE E MANHA": "FL3:FL46",
                "2ª SERIE F NOITE": "FQ3:FQ46",
                "2ª SERIE G NOITE": "FV3:FV46",
                "2ª SERIE H NOITE": "GA3:GA46",
                "3ª SERIE A MANHA": "GK3:GK46",
                "3ª SERIE B MANHA": "GP3:GP46",
                "3ª SERIE C MANHA": "GU3:GU46",
                "3ª SERIE D NOITE": "GZ3:GZ46",
                "3ª SERIE E NOITE": "HE3:HE46",
                "3ª SERIE F NOITE": "HJ3:HJ46"
            };
        }

        // Lista de professores
        function getAllTeachers() {
            return [
                "ALEX LUTH PEREIRA MARANHAO",
                "ALEXSANDRA PAULA VARELLA DE SOUZA",
                "ALISON VASCONCELOS BESERRA",
                "AMAURI TEODORO DE OLIVEIRA",
                "ANA PAULA DOS SANTOS",
                "ANDREIA DOS SANTOS FREITAS",
                "ANDREIA MADUREIRA REIS",
                "ANTONIO CARLOS DE OLIVEIRA",
                "ANTONIO RAMOS DE ARAUJO",
                "ANTONIO WILTON WANDERLEY CABRAL",
                "AUGUSTO LINO PESSOA NETO",
                "AUREA MARIA DE JESUS MARQUES",
                "CAROLINA PERNOMIAN PARUSSOLOLO",
                "CASSIA OLIVEIRA ANTONIAZI",
                "CLAUDINEIA DE AGUIAR LIMA",
                "DANIEL DE FREITAS ALMEIDA",
                "DANIEL LOPES BARBOSA",
                "DANIELA FERREIRA LIMA",
                "DANIELLE LUCIA BATISTA DE ALMEIDA",
                "EDIANE VIEIRA DA SILVA",
                "EDILEUSA NUNES PEREIRA",
                "EDUARDO HENRIQUE DA FONSECA",
                "ELIANE SANTOS SILVA",
                "ELIAS MONTEIRO DA SILVA",
                "ELISABETE APARECIDA PIRES",
                "ELZA DE FARIA PEREIRA",
                "EMERSON GABLER DE ALMEIDA",
                "EUZELI ARAUJO DE OLIVEIRA",
                "FABIANO AUGUSTO PIEDADE",
                "FABIO CAMILO",
                "FERNANDO JOSE DA SILVA FILHO",
                "FLAVIA CRISTINA APARECIDA BICHLER",
                "FLAVIO CARDOSO FLEURY",
                "FRANCISCA EDIVANIA DE MORAIS COSTA",
                "GABRIELA SERIGHELLI DE MELO",
                "GELSON DE ALMEIDA BATISTA",
                "GENILTON DE OLIVEIRA SILVA",
                "GIANI CRISTINA DO PRADO",
                "INGRYD CAROLINA SUGUIMOTO VIEIRA",
                "IVANILDES DOS SANTOS OSHIKAWA",
                "JANINA DOS PASSOS BRAGA DE ALMEIDA",
                "JOSE APARECIDO DA SILVA",
                "JUAREZ GOMES DE MAGALHAES FILHO",
                "JUREMA SOLEDADE FURINI SANTOS",
                "KATIUSCIA ALVES BOMFIM",
                "LUANA CAROLINE ALVES LIMA",
                "LUANA DE FREITAS SILVA",
                "LUCIANA NOVAIS CORREIA SANTOS",
                "LUCIANO MOREIRA DE AZEVEDO",
                "MARCIEL DA SILVA",
                "MARIA HELENA CUNHA MORO",
                "MARIA QUITÉRIA FERREIRA DOS SANTOS",
                "MARINA DA CONCEICAO FRANCISCO SILVA",
                "MAURICIO DE BARROS SANTOS",
                "MICHELE DE PINHO MORAES",
                "MOISES ANTONIO DE BARROS",
                "PAULA ARMANI VILA",
                "PAULO ROBERTO DA SILVA ITO",
                "PEDRO ZANOTTI FILHO",
                "RAUL PEREIRA VILERA JUNIOR",
                "REGIANE CURTI DE SOUZA OLIVEIRA",
                "REGINA DA SILSA CASTRO",
                "RICARDO AMERICO DA SILVA",
                "ROBERTO SALGADO",
                "RODRIGO VIEIRA",
                "ROSANGELA CAFASSO MOREIRA",
                "ROSIMERY DE SOUZA PESSOA",
                "ROSMARA DA SILSA CARDOSO",
                "SANDRA CRISTINA MACEDO MORAES",
                "SELMA GOMES DA SILSA",
                "SERGIO AGRIPINO VILLA NOVA",
                "SOLANGE ALMEIDA DA SILSA",
                "SUZINEIDE SILSA DE FREITAS",
                "THIAGO FABIANO BRITO",
                "TITTO AUGUSTO NASCIMENTO SILSA",
                "VANDERSON HYPPOLITO",
                "VANESSA IVETE GOMES DOS SANTOS",
                "VANIA PENHA DE BARROS",
                "VIVIANE LEAL CAMERA DE MORAES",
                "WILSON RODRIGUES MOTA"
            ];
        }

        // Variáveis globais
        let allStudents = [];
        let selectedStudents = [];
        let currentUser = '';

        // Função de login
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Verificação simples de e-mail e senha (em produção, isso deve ser feito no backend)
            if (email === 'gestao@escola.com' && password === 'gestao123') {
                currentUser = 'gestao';
                showGestaoInterface(email);
                document.getElementById('downloadPdfBtn').style.display = 'block';
            } else if (email === 'professor@escola.com' && password === 'prof123') {
                currentUser = 'professor';
                showProfessorInterface(email);
                loadTeachers();
                loadClassOptions();
                document.getElementById('downloadPdfBtn').style.display = 'none';
            } else {
                alert('E-mail ou senha incorretos. Tente novamente.');
            }
        }

        // Função para mostrar interface de gestão
        function showGestaoInterface(email) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('gestaoContainer').style.display = 'block';
            document.getElementById('professorContainer').style.display = 'none';
            document.getElementById('userName').textContent = email;
        }

        // Função para mostrar interface do professor
        function showProfessorInterface(email) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('gestaoContainer').style.display = 'none';
            document.getElementById('professorContainer').style.display = 'block';
            document.getElementById('userName').textContent = email;
        }

        // Função de logout
        function logout() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('downloadPdfBtn').style.display = 'none';
        }

        // Alternar visibilidade do campo de data de retorno para suspensões
        function toggleSuspensionField() {
            const classificacao = document.getElementById('classificacao').value;
            const suspensionField = document.getElementById('suspensionField');
            
            if (classificacao === 'SUSPENSÃO') {
                suspensionField.style.display = 'flex';
            } else {
                suspensionField.style.display = 'none';
            }
        }

        // Carregar professores no dropdown
        function loadTeachers() {
            const professorSelect = document.getElementById('professorNome');
            professorSelect.innerHTML = '<option value="">Selecione o professor</option>';
            
            const teachers = getAllTeachers();
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                professorSelect.appendChild(option);
            });
        }

        // Carregar opções de turma
        function loadClassOptions() {
            const turmaSelect = document.getElementById('professorTurma');
            turmaSelect.innerHTML = '<option value="">Selecione a turma</option>';
            
            const classRanges = _getClassRanges();
            Object.keys(classRanges).forEach(turma => {
                const option = document.createElement('option');
                option.value = turma;
                option.textContent = turma;
                turmaSelect.appendChild(option);
            });
        }

        // Buscar alunos por nome (autocomplete)
        function searchStudents(query) {
            const autocompleteList = document.getElementById('autocomplete-list');
            autocompleteList.innerHTML = '';
            
            if (query.length < 2) return;
            
            // Simulação de busca - em produção, isso viria do backend
            const filteredStudents = allStudents.filter(student => 
                student.nome.toLowerCase().includes(query.toLowerCase())
            );
            
            filteredStudents.forEach(student => {
                const div = document.createElement('div');
                div.innerHTML = `<strong>${student.nome}</strong> - ${student.turma}`;
                div.addEventListener('click', () => {
                    document.getElementById('aluno').value = student.nome;
                    document.getElementById('serie').value = student.turma;
                    document.getElementById('ra').value = student.ra;
                    autocompleteList.innerHTML = '';
                });
                autocompleteList.appendChild(div);
            });
        }

        // Carregar alunos da turma selecionada
        function loadClassStudents() {
            const turma = document.getElementById('professorTurma').value;
            if (!turma) return;
            
            // Simulação - em produção, isso viria do backend
            // Vamos criar alguns alunos de exemplo baseados na turma
            selectedStudents = [];
            document.getElementById('alunoOcorrencia').value = '';
            
            // Gerar alguns alunos de exemplo
            const exampleStudents = [
                { id: 1, nome: `Aluno 1 - ${turma}` },
                { id: 2, nome: `Aluno 2 - ${turma}` },
                { id: 3, nome: `Aluno 3 - ${turma}` },
                { id: 4, nome: `Aluno 4 - ${turma}` },
                { id: 5, nome: `Aluno 5 - ${turma}` }
            ];
            
            // Armazenar para uso no popup
            window.currentClassStudents = exampleStudents;
        }

        // Mostrar popup de seleção de alunos
        function showStudentsPopup() {
            const turma = document.getElementById('professorTurma').value;
            if (!turma) {
                alert('Por favor, selecione uma turma primeiro.');
                return;
            }
            
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            window.currentClassStudents.forEach(student => {
                const isSelected = selectedStudents.some(s => s.id === student.id);
                
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <input type="checkbox" id="student-${student.id}" value="${student.id}" ${isSelected ? 'checked' : ''}>
                    <label for="student-${student.id}">${student.nome}</label>
                `;
                studentList.appendChild(studentItem);
            });
            
            document.getElementById('studentsPopup').classList.remove('hidden');
        }

        // Fechar popup de seleção de alunos
        function closeStudentsPopup() {
            document.getElementById('studentsPopup').classList.add('hidden');
        }

        // Confirmar seleção de alunos
        function confirmStudentsSelection() {
            const checkboxes = document.querySelectorAll('#studentList input[type="checkbox"]:checked');
            selectedStudents = [];
            
            checkboxes.forEach(checkbox => {
                const studentId = parseInt(checkbox.value);
                const student = window.currentClassStudents.find(s => s.id === studentId);
                if (student) {
                    selectedStudents.push(student);
                }
            });
            
            document.getElementById('alunoOcorrencia').value = selectedStudents.map(s => s.nome).join(', ');
            closeStudentsPopup();
        }

        // Mostrar informações do campo
        function showFieldInfo(infoId, event) {
            // Esta função é acionada pelo clique no campo
            // As informações já são exibidas via CSS no hover
            event.stopPropagation();
        }

        // Gerar PDF (simulação)
        function generatePDF() {
            // Em produção, isso geraria um PDF com os dados do aluno
            alert('PDF gerado com sucesso! Em produção, isso faria o download do documento.');
            
            // Simular download
            const link = document.createElement('a');
            link.href = 'data:application/pdf;base64,simulacao';
            link.download = 'ocorrencia.pdf';
            link.click();
        }

        // Cadastrar ocorrência (Gestão)
        function cadastrarOcorrencia() {
            const aluno = document.getElementById('aluno').value;
            const serie = document.getElementById('serie').value;
            const professor = document.getElementById('professor').value;
            const ra = document.getElementById('ra').value;
            const disciplina = document.getElementById('disciplina').value;
            const classificacao = document.getElementById('classificacao').value;
            const dataRetorno = document.getElementById('dataRetorno').value;
            const descricao = document.getElementById('descricao').value;
            
            // Validação básica
            if (!aluno || !serie || !professor || !disciplina || !classificacao || !descricao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            if (classificacao === 'SUSPENSÃO' && !dataRetorno) {
                alert('Para suspensão, é necessário informar a data de retorno.');
                return;
            }
            
            // Dados para enviar ao Google Sheets
            const ocorrenciaData = {
                nome: aluno,
                serie: serie,
                professor: professor,
                ra: ra,
                disciplina: disciplina,
                data: new Date().toLocaleString('pt-BR'),
                descricao: descricao,
                dataRetorno: dataRetorno || '',
                tipo: 'GESTÃO'
            };
            
            // Simulação de envio para o Google Apps Script
            console.log('Dados da ocorrência (Gestão):', ocorrenciaData);
            
            // Em produção, descomente e ajuste o código abaixo:
            /*
            fetch(SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'registerOccurrence',
                    spreadsheetId: SPREADSHEET_ID,
                    sheetName: 'BANCODEALUNOS',
                    data: ocorrenciaData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessMessage('successMessage');
                } else {
                    alert('Erro ao registrar ocorrência: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao conectar com o servidor.');
            });
            */
            
            // Simular sucesso
            showSuccessMessage('successMessage');
        }

        // Registrar ocorrência (Professor)
        function registrarOcorrenciaProfessor() {
            const professor = document.getElementById('professorNome').value;
            const turma = document.getElementById('professorTurma').value;
            const alunos = document.getElementById('alunoOcorrencia').value;
            const dataOcorrencia = document.getElementById('dataOcorrencia').value;
            
            // Obter irregularidades selecionadas
            const irregularidades = [];
            document.querySelectorAll('input[name="irregularidades"]:checked').forEach(input => {
                irregularidades.push(input.value);
            });
            
            const descricao = document.getElementById('descricaoOcorrencia').value;
            
            // Validação básica
            if (!professor || !turma || !alunos || !dataOcorrencia || irregularidades.length === 0 || !descricao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Dados para enviar ao Google Sheets
            const ocorrenciaData = {
                data: dataOcorrencia,
                professor: professor,
                turma: turma,
                aluno: alunos,
                irregularidades: irregularidades.join(', '),
                descricao: descricao,
                tipo: 'PROFESSOR'
            };
            
            // Simulação de envio para o Google Apps Script
            console.log('Dados da ocorrência (Professor):', ocorrenciaData);
            
            // Em produção, descomente e ajuste o código abaixo:
            /*
            fetch(SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'registerTeacherOccurrence',
                    spreadsheetId: SPREADSHEET_ID,
                    sheetName: 'OCORRENCIASDOSPROFESSORES',
                    data: ocorrenciaData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccessMessage('professorSuccessMessage');
                } else {
                    alert('Erro ao registrar ocorrência: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao conectar com o servidor.');
            });
            */
            
            // Simular sucesso
            showSuccessMessage('professorSuccessMessage');
        }

        // Mostrar mensagem de sucesso
        function showSuccessMessage(messageId) {
            const messageElement = document.getElementById(messageId);
            messageElement.style.display = 'block';
            
            // Limpar formulário após 2 segundos
            setTimeout(() => {
                messageElement.style.display = 'none';
                
                if (messageId === 'successMessage') {
                    document.getElementById('aluno').value = '';
                    document.getElementById('serie').value = '';
                    document.getElementById('professor').value = '';
                    document.getElementById('ra').value = '';
                    document.getElementById('disciplina').value = '';
                    document.getElementById('classificacao').value = '';
                    document.getElementById('dataRetorno').value = '';
                    document.getElementById('descricao').value = '';
                    document.getElementById('suspensionField').style.display = 'none';
                } else {
                    document.getElementById('professorNome').value = '';
                    document.getElementById('professorTurma').value = '';
                    document.getElementById('alunoOcorrencia').value = '';
                    document.getElementById('dataOcorrencia').value = '';
                    document.querySelectorAll('input[name="irregularidades"]:checked').forEach(input => {
                        input.checked = false;
                    });
                    document.getElementById('descricaoOcorrencia').value = '';
                    selectedStudents = [];
                }
            }, 2000);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual como padrão para o campo de data da ocorrência (professor)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dataOcorrencia').value = today;
            
            // Simular alguns dados de alunos para demonstração
            allStudents = [
                { nome: "João Silva", turma: "6° ANO A MANHA", ra: "12345" },
                { nome: "Maria Santos", turma: "6° ANO A MANHA", ra: "12346" },
                { nome: "Pedro Oliveira", turma: "6° ANO B MANHA", ra: "12347" },
                { nome: "Ana Costa", turma: "7° ANO A TARDE", ra: "12348" },
                { nome: "Carlos Pereira", turma: "8° ANO A TARDE", ra: "12349" }
            ];
            
            // Fechar popup ao clicar fora dele
            document.addEventListener('click', function(event) {
                const popup = document.getElementById('studentsPopup');
                if (!popup.classList.contains('hidden') && !event.target.closest('.popup-content')) {
                    closeStudentsPopup();
                }
            });
        });
    </script>
</body>
</html>
