<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 - Cadastro de Ocorrências</title>
    <!-- Biblioteca para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #001f3f;
        }

        .login-form {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 350px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #001f3f;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .login-btn {
            width: 100%;
            padding: 10px;
            background-color: #001f3f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .login-btn:hover {
            background-color: #003366;
        }

        .app-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #001f3f;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .content {
            flex: 1;
            padding: 20px;
        }

        /* Estilos específicos para a interface de gestão */
        .gestao-container {
            display: none;
        }

        .form-title {
            background-color: #001f3f;
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .gestao-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }

        .form-field {
            flex: 1;
            min-width: 200px;
        }

        .form-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-field input, .form-field select, .form-field textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-field textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            background-color: #001f3f;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .success-message {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            display: none;
            border-radius: 4px;
        }

        /* Estilos específicos para a interface do professor */
        .professor-container {
            display: none;
        }

        .occurrence-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: #001f3f;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-item input {
            margin-right: 5px;
        }

        .hidden {
            display: none;
        }

        /* Estilos para autocomplete */
        .autocomplete {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        .autocomplete-active {
            background-color: #001f3f !important;
            color: #ffffff;
        }

        /* Estilos para o modal de seleção de alunos */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .student-list {
            margin-top: 15px;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .student-item:hover {
            background-color: #f5f5f5;
        }

        .selected-students {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .selected-student {
            display: inline-block;
            background-color: #e0e0e0;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 4px;
        }

        .download-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }

        .download-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2>2025 - Cadastro de Ocorrências</h2>
            <div class="form-group">
                <label for="email">E-mail:</label>
                <input type="email" id="email" placeholder="Digite seu e-mail">
            </div>
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" placeholder="Digite sua senha">
            </div>
            <button class="login-btn" onclick="login()">Entrar</button>
        </div>
    </div>

    <!-- Container principal da aplicação -->
    <div class="app-container" id="appContainer">
        <div class="header">
            <h1>2025 - Cadastro de Ocorrências</h1>
            <div class="user-info">
                <span id="userName">Usuário</span>
                <button class="logout-btn" onclick="logout()">Sair</button>
                <button class="download-btn" id="downloadPdfBtn" style="display:none;" onclick="generatePDF()">Baixar PDF</button>
            </div>
        </div>

        <!-- Interface de Gestão -->
        <div class="content gestao-container" id="gestaoContainer">
            <div class="form-title">
                CADASTRO DE OCORRÊNCIAS - GESTÃO
            </div>
            <div class="gestao-form">
                <div class="form-row">
                    <div class="form-field">
                        <label for="aluno">ALUNO:</label>
                        <div class="autocomplete">
                            <input type="text" id="aluno" oninput="autocompleteAluno(this.value)">
                            <div id="autocomplete-list" class="autocomplete-items"></div>
                        </div>
                    </div>
                    <div class="form-field">
                        <label for="serie">SÉRIE/TURMA:</label>
                        <input type="text" id="serie" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="professor">PROFESSOR:</label>
                        <input type="text" id="professor">
                    </div>
                    <div class="form-field">
                        <label for="ra">RA:</label>
                        <input type="text" id="ra" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="disciplina">DISCIPLINA:</label>
                        <input type="text" id="disciplina">
                    </div>
                    <div class="form-field">
                        <label for="classificacao">CLASSIFICAÇÃO:</label>
                        <select id="classificacao" onchange="toggleSuspensionField()">
                            <option value="">Selecione</option>
                            <option value="OCORRÊNCIA">OCORRÊNCIA</option>
                            <option value="SUSPENSÃO">SUSPENSÃO</option>
                        </select>
                    </div>
                </div>
                <div class="form-row" id="suspensionField" style="display: none;">
                    <div class="form-field">
                        <label for="dataRetorno">DATA DE RETORNO:</label>
                        <input type="date" id="dataRetorno">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="descricao">DESCRIÇÃO:</label>
                        <textarea id="descricao"></textarea>
                    </div>
                </div>
                <button class="submit-btn" onclick="cadastrarOcorrencia()">Cadastrar Ocorrência</button>
                
                <div class="success-message" id="successMessage">
                    OCORRÊNCIA REGISTRADA COM SUCESSO
                </div>
            </div>
        </div>

        <!-- Interface do Professor -->
        <div class="content professor-container" id="professorContainer">
            <div class="form-title">
                REGISTRO DE OCORRÊNCIAS - PROFESSOR
            </div>
            <div class="occurrence-form">
                <div class="form-section">
                    <h3>1. IDENTIFICAÇÃO DA OCORRÊNCIA</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="professorNome">NOME DO PROFESSOR:</label>
                            <select id="professorNome">
                                <option value="">Selecione o professor</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="professorTurma">TURMA:</label>
                            <select id="professorTurma" onchange="carregarAlunosTurma()">
                                <option value="">Selecione a turma</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="alunoOcorrencia">ALUNO(S) ENVOLVIDO(S):</label>
                            <input type="text" id="alunoOcorrencia" readonly onclick="abrirModalAlunos()">
                            <div id="selectedStudents" class="selected-students"></div>
                        </div>
                        <div class="form-field">
                            <label for="dataOcorrencia">DATA DA OCORRÊNCIA:</label>
                            <input type="date" id="dataOcorrencia">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>2. TIPO DE IRREGULARIDADE</h3>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade1" name="irregularidades" value="Indisciplina">
                            <label for="irregularidade1">Indisciplina</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade2" name="irregularidades" value="Uso de celular">
                            <label for="irregularidade2">Uso de celular</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade3" name="irregularidades" value="Conversa paralela">
                            <label for="irregularidade3">Conversa paralela</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade4" name="irregularidades" value="Agressão verbal">
                            <label for="irregularidade4">Agressão verbal</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade5" name="irregularidades" value="Agressão física">
                            <label for="irregularidade5">Agressão física</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade6" name="irregularidades" value="Danos ao patrimônio">
                            <label for="irregularidade6">Danos ao patrimônio</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="irregularidade7" name="irregularidades" value="Outros">
                            <label for="irregularidade7">Outros</label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>3. DESCRIÇÃO DA OCORRÊNCIA</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <textarea id="descricaoOcorrencia" placeholder="Descreva detalhadamente a ocorrência..."></textarea>
                        </div>
                    </div>
                </div>

                <button class="submit-btn" onclick="registrarOcorrenciaProfessor()">Registrar Ocorrência</button>
                
                <div class="success-message" id="professorSuccessMessage">
                    OCORRÊNCIA REGISTRADA COM SUCESSO
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para seleção de alunos -->
    <div id="alunosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalAlunos()">&times;</span>
            <h3>Selecione os alunos envolvidos</h3>
            <div id="studentList" class="student-list">
                <!-- Lista de alunos será preenchida aqui -->
            </div>
            <button class="submit-btn" style="margin-top: 15px;" onclick="confirmarAlunos()">Confirmar</button>
        </div>
    </div>

    <script>
        // URLs do Google Apps Script Web App
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw5w7k1M5zU8Q2UJd1RkZQ7Q4V5X4Q3Q2Q1Q0Q0Q0/exec';
        const SPREADSHEET_ID = '1u7qMsMHkZT47OZdar5qvshQDRA8XJrLgDjAZVOViAio';

        // Variáveis globais
        let alunos = [];
        let professores = [];
        let turmas = [];
        let alunosSelecionados = [];
        let currentAlunoData = null;

        // Funções de mapeamento (simulando backend)
        function _getClassRanges() {
            return {
                "6° ANO A MANHA": "C3:C46",
                "6° ANO B MANHA": "H3:H46",
                "6° ANO C MANHA": "M3:M46",
                "6° ANO D MANHA": "R3:R46",
                "6° ANO E TARDE": "W3:W46",
                "6° ANO F TARDE": "AB3:AB46",
                "7° ANO A TARDE": "AG3:AG46",
                "7° ANO B TARDE": "AL3:AL46",
                "7° ANO C TARDE": "AQ3:AQ46",
                "7° ANO D TARDE": "AV3:AV46",
                "7° ANO E TARDE": "BA3:BA46",
                "7° ANO F TARDE": "BF3:BF46",
                "8° ANO A TARDE": "BK3:BK46",
                "8° ANO B TARDE": "BP3:BP46",
                "8° ANO C TARDE": "BU3:BU46",
                "8° ANO D TARDE": "BZ3:BZ46",
                "9° ANO A TARDE": "CE3:CE46",
                "9° ANO B TARDE": "CJ3:CJ46",
                "9° ANO C TARDE": "CO3:CO46",
                "9° ANO D TARDE": "CT3:CT46",
                "1ª SERIE A MANHA": "CY3:CY46",
                "1ª SERIE B MANHA": "DD3:DD46",
                "1ª SERIE C MANHA": "DI3:DI46",
                "1ª SERIE D MANHA": "DN3:DN46",
                "1ª SERIE E MANHA": "DS3:DS46",
                "1ª SERIE F MANHA": "DX3:DX46",
                "1ª SERIE G TARDE": "EC3:EC46",
                "1ª SERIE H NOITE": "EH3:EH46",
                "1ª SERIE I NOITE": "EM3:EM46",
                "2ª SERIE A MANHA": "ER3:ER46",
                "2ª SERIE B MANHA": "EW3:EW46",
                "2ª SERIE C MANHA": "FB3:FB46",
                "2ª SERIE D MANHA": "FG3:FG46",
                "2ª SERIE E MANHA": "FL3:FL46",
                "2ª SERIE F NOITE": "FQ3:FQ46",
                "2ª SERIE G NOITE": "FV3:FV46",
                "2ª SERIE H NOITE": "GA3:GA46",
                "3ª SERIE A MANHA": "GK3:GK46",
                "3ª SERIE B MANHA": "GP3:GP46",
                "3ª SERIE C MANHA": "GU3:GU46",
                "3ª SERIE D NOITE": "GZ3:GZ46",
                "3ª SERIE E NOITE": "HE3:HE46",
                "3ª SERIE F NOITE": "HJ3:HJ46"
            };
        }

        function getAllTeachers() {
            return [
                "ALEX LUTH PEREIRA MARANHAO",
                "ALEXSANDRA PAULA VARELLA DE SOUZA",
                "ALISON VASCONCELOS BESERRA",
                "AMAURI TEODORO DE OLIVEIRA",
                "ANA PAULA DOS SANTOS",
                "ANDREIA DOS SANTOS FREITAS",
                "ANDREIA MADUREIRA REIS",
                "ANTONIO CARLOS DE OLIVEIRA",
                "ANTONIO RAMOS DE ARAUJO",
                "ANTONIO WILTON WANDERLEY CABRAL",
                "AUGUSTO LINO PESSOA NETO",
                "AUREA MARIA DE JESUS MARQUES",
                "CAROLINA PERNOMIAN PARUSSOLOLO",
                "CASSIA OLIVEIRA ANTONIAZI",
                "CLAUDINEIA DE AGUIAR LIMA",
                "DANIEL DE FREITAS ALMEIDA",
                "DANIEL LOPES BARBOSA",
                "DANIELA FERREIRA LIMA",
                "DANIELLE LUCIA BATISTA DE ALMEIDA",
                "EDIANE VIEIRA DA SILVA",
                "EDILEUSA NUNES PEREIRA",
                "EDUARDO HENRIQUE DA FONSECA",
                "ELIANE SANTOS SILVA",
                "ELIAS MONTEIRO DA SILVA",
                "ELISABETE APARECIDA PIRES",
                "ELZA DE FARIA PEREIRA",
                "EMERSON GABLER DE ALMEIDA",
                "EUZELI ARAUJO DE OLIVEIRA",
                "FABIANO AUGUSTO PIEDADE",
                "FABIO CAMILO",
                "FERNANDO JOSE DA SILVA FILHO",
                "FLAVIA CRISTINA APARECIDA BICHLER",
                "FLAVIO CARDOSO FLEURY",
                "FRANCISCA EDIVANIA DE MORAIS COSTA",
                "GABRIELA SERIGHELLI DE MELO",
                "GELSON DE ALMEIDA BATISTA",
                "GENILTON DE OLIVEIRA SILVA",
                "GIANI CRISTINA DO PRADO",
                "INGRYD CAROLINA SUGUIMOTO VIEIRA",
                "IVANILDES DOS SANTOS OSHIKAWA",
                "JANINA DOS PASSOS BRAGA DE ALMEIDA",
                "JOSE APARECIDO DA SILVA",
                "JUAREZ GOMES DE MAGALHAES FILHO",
                "JUREMA SOLEDADE FURINI SANTOS",
                "KATIUSCIA ALVES BOMFIM",
                "LUANA CAROLINE ALVES LIMA",
                "LUANA DE FREITAS SILVA",
                "LUCIANA NOVAIS CORREIA SANTOS",
                "LUCIANO MOREIRA DE AZEVEDO",
                "MARCIEL DA SILVA",
                "MARIA HELENA CUNHA MORO",
                "MARIA QUITÉRIA FERREIRA DOS SANTOS",
                "MARINA DA CONCEICAO FRANCISCO SILVA",
                "MAURICIO DE BARROS SANTOS",
                "MICHELE DE PINHO MORAES",
                "MOISES ANTONIO DE BARROS",
                "PAULA ARMANI VILA",
                "PAULO ROBERTO DA SILVA ITO",
                "PEDRO ZANOTTI FILHO",
                "RAUL PEREIRA VILERA JUNIOR",
                "REGIANE CURTI DE SOUZA OLIVEIRA",
                "REGINA DA SILSA CASTRO",
                "RICARDO AMERICO DA SILVA",
                "ROBERTO SALGADO",
                "RODRIGO VIEIRA",
                "ROSANGELA CAFASSO MOREIRA",
                "ROSIMERY DE SOUZA PESSOA",
                "ROSMARA DA SILSA CARDOSO",
                "SANDRA CRISTINA MACEDO MORAES",
                "SELMA GOMES DA SILSA",
                "SERGIO AGRIPINO VILLA NOVA",
                "SOLANGE ALMEIDA DA SILSA",
                "SUZINEIDE SILSA DE FREITAS",
                "THIAGO FABIANO BRITO",
                "TITTO AUGUSTO NASCIMENTO SILSA",
                "VANDERSON HYPPOLITO",
                "VANESSA IVETE GOMES DOS SANTOS",
                "VANIA PENHA DE BARROS",
                "VIVIANE LEAL CAMERA DE MORAES",
                "WILSON RODRIGUES MOTA"
            ];
        }

        // Função de login
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Verificação simples de e-mail e senha (em produção, isso deve ser feito no backend)
            if (email === 'gestao@escola.com' && password === 'gestao123') {
                showGestaoInterface(email);
                carregarDadosIniciais();
                document.getElementById('downloadPdfBtn').style.display = 'inline-block';
            } else if (email === 'professor@escola.com' && password === 'prof123') {
                showProfessorInterface(email);
                carregarDadosIniciais();
                document.getElementById('downloadPdfBtn').style.display = 'none';
            } else {
                alert('E-mail ou senha incorretos. Tente novamente.');
            }
        }

        // Carregar dados iniciais
        function carregarDadosIniciais() {
            // Carregar professores
            professores = getAllTeachers();
            const professorSelect = document.getElementById('professorNome');
            professorSelect.innerHTML = '<option value="">Selecione o professor</option>';
            professores.forEach(professor => {
                const option = document.createElement('option');
                option.value = professor;
                option.textContent = professor;
                professorSelect.appendChild(option);
            });

            // Carregar turmas
            turmas = Object.keys(_getClassRanges());
            const turmaSelect = document.getElementById('professorTurma');
            turmaSelect.innerHTML = '<option value="">Selecione a turma</option>';
            turmas.forEach(turma => {
                const option = document.createElement('option');
                option.value = turma;
                option.textContent = turma;
                turmaSelect.appendChild(option);
            });

            // Simular carregamento de alunos (em produção, isso viria do backend)
            setTimeout(() => {
                alunos = [
                    { nome: "ANA CAROLINA SILVA", turma: "6° ANO A MANHA", ra: "12345" },
                    { nome: "PEDRO HENRIQUE OLIVEIRA", turma: "6° ANO A MANHA", ra: "12346" },
                    { nome: "MARIA EDUARDA SANTOS", turma: "6° ANO B MANHA", ra: "12347" },
                    { nome: "JOÃO VITOR COSTA", turma: "6° ANO B MANHA", ra: "12348" },
                    { nome: "LUCAS GABRIEL PEREIRA", turma: "7° ANO A TARDE", ra: "12349" },
                    { nome: "SOFIA ALMEIDA", turma: "7° ANO A TARDE", ra: "12350" },
                    { nome: "ENZO FERNANDES", turma: "8° ANO A TARDE", ra: "12351" },
                    { nome: "LAURA MENDES", turma: "8° ANO A TARDE", ra: "12352" },
                    { nome: "GUILHERME RODRIGUES", turma: "9° ANO A TARDE", ra: "12353" },
                    { nome: "ISABELLA MARTINS", turma: "9° ANO A TARDE", ra: "12354" }
                ];
            }, 500);
        }

        // Função para mostrar interface de gestão
        function showGestaoInterface(email) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('gestaoContainer').style.display = 'block';
            document.getElementById('professorContainer').style.display = 'none';
            document.getElementById('userName').textContent = email;
        }

        // Função para mostrar interface do professor
        function showProfessorInterface(email) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('gestaoContainer').style.display = 'none';
            document.getElementById('professorContainer').style.display = 'block';
            document.getElementById('userName').textContent = email;
        }

        // Função de logout
        function logout() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('downloadPdfBtn').style.display = 'none';
        }

        // Autocomplete para alunos
        function autocompleteAluno(valor) {
            const autocompleteList = document.getElementById("autocomplete-list");
            autocompleteList.innerHTML = "";
            
            if (!valor) return;
            
            const filteredAlunos = alunos.filter(aluno => 
                aluno.nome.toLowerCase().includes(valor.toLowerCase())
            );
            
            filteredAlunos.forEach(aluno => {
                const div = document.createElement("div");
                div.innerHTML = `<strong>${aluno.nome}</strong> - ${aluno.turma}`;
                div.addEventListener("click", function() {
                    document.getElementById("aluno").value = aluno.nome;
                    document.getElementById("serie").value = aluno.turma;
                    document.getElementById("ra").value = aluno.ra;
                    autocompleteList.innerHTML = "";
                    currentAlunoData = aluno;
                });
                autocompleteList.appendChild(div);
            });
        }

        // Alternar visibilidade do campo de data de retorno para suspensões
        function toggleSuspensionField() {
            const classificacao = document.getElementById('classificacao').value;
            const suspensionField = document.getElementById('suspensionField');
            
            if (classificacao === 'SUSPENSÃO') {
                suspensionField.style.display = 'flex';
            } else {
                suspensionField.style.display = 'none';
            }
        }

        // Cadastrar ocorrência (Gestão)
        function cadastrarOcorrencia() {
            const aluno = document.getElementById('aluno').value;
            const serie = document.getElementById('serie').value;
            const professor = document.getElementById('professor').value;
            const ra = document.getElementById('ra').value;
            const disciplina = document.getElementById('disciplina').value;
            const classificacao = document.getElementById('classificacao').value;
            const dataRetorno = document.getElementById('dataRetorno').value;
            const descricao = document.getElementById('descricao').value;
            
            // Validação básica
            if (!aluno || !serie || !professor || !disciplina || !classificacao || !descricao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            if (classificacao === 'SUSPENSÃO' && !dataRetorno) {
                alert('Para suspensão, é necessário informar a data de retorno.');
                return;
            }
            
            // Dados para enviar para a planilha
            const data = new Date();
            const dataRegistro = `${data.toLocaleDateString()} ${data.toLocaleTimeString()}`;
            
            const dados = {
                nome: aluno,
                serie: serie,
                professor: professor,
                ra: ra,
                disciplina: disciplina,
                dataRegistro: dataRegistro,
                descricao: descricao,
                dataRetorno: dataRetorno || 'N/A'
            };
            
            // Simulação de envio para o Google Apps Script
            console.log('Dados da ocorrência (Gestão):', dados);
            
            // Aqui você faria a chamada real para o Google Apps Script
            // fetch(SCRIPT_URL, {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     body: JSON.stringify({
            //         action: 'cadastrarOcorrenciaGestao',
            //         spreadsheetId: SPREADSHEET_ID,
            //         data: dados
            //     })
            // })
            
            // Mostrar mensagem de sucesso
            document.getElementById('successMessage').style.display = 'block';
            
            // Limpar formulário após 2 segundos
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('aluno').value = '';
                document.getElementById('serie').value = '';
                document.getElementById('professor').value = '';
                document.getElementById('ra').value = '';
                document.getElementById('disciplina').value = '';
                document.getElementById('classificacao').value = '';
                document.getElementById('dataRetorno').value = '';
                document.getElementById('descricao').value = '';
                document.getElementById('suspensionField').style.display = 'none';
            }, 2000);
        }

        // Carregar alunos da turma selecionada
        function carregarAlunosTurma() {
            const turma = document.getElementById('professorTurma').value;
            if (!turma) return;
            
            // Filtrar alunos pela turma selecionada
            const alunosTurma = alunos.filter(aluno => aluno.turma === turma);
            
            // Armazenar alunos da turma para uso no modal
            window.alunosTurmaAtual = alunosTurma;
        }

        // Abrir modal de seleção de alunos
        function abrirModalAlunos() {
            const turma = document.getElementById('professorTurma').value;
            if (!turma) {
                alert('Por favor, selecione uma turma primeiro.');
                return;
            }
            
            const modal = document.getElementById('alunosModal');
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            // Adicionar alunos à lista
            window.alunosTurmaAtual.forEach(aluno => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <input type="checkbox" id="aluno-${aluno.ra}" value="${aluno.nome}" 
                        ${alunosSelecionados.includes(aluno.nome) ? 'checked' : ''}>
                    <label for="aluno-${aluno.ra}">${aluno.nome} (RA: ${aluno.ra})</label>
                `;
                studentList.appendChild(studentItem);
            });
            
            modal.style.display = 'block';
        }

        // Fechar modal de alunos
        function fecharModalAlunos() {
            document.getElementById('alunosModal').style.display = 'none';
        }

        // Confirmar seleção de alunos
        function confirmarAlunos() {
            const checkboxes = document.querySelectorAll('#studentList input[type="checkbox"]:checked');
            alunosSelecionados = Array.from(checkboxes).map(cb => cb.value);
            
            // Atualizar campo de alunos selecionados
            const selectedStudentsDiv = document.getElementById('selectedStudents');
            selectedStudentsDiv.innerHTML = '';
            
            if (alunosSelecionados.length === 0) {
                selectedStudentsDiv.innerHTML = '<p>Nenhum aluno selecionado</p>';
            } else {
                alunosSelecionados.forEach(aluno => {
                    const span = document.createElement('span');
                    span.className = 'selected-student';
                    span.textContent = aluno;
                    selectedStudentsDiv.appendChild(span);
                });
            }
            
            // Fechar o modal
            fecharModalAlunos();
        }

        // Registrar ocorrência (Professor)
        function registrarOcorrenciaProfessor() {
            const professor = document.getElementById('professorNome').value;
            const turma = document.getElementById('professorTurma').value;
            const dataOcorrencia = document.getElementById('dataOcorrencia').value;
            
            // Obter irregularidades selecionadas
            const irregularidades = [];
            document.querySelectorAll('input[name="irregularidades"]:checked').forEach(input => {
                irregularidades.push(input.value);
            });
            
            const descricao = document.getElementById('descricaoOcorrencia').value;
            
            // Validação básica
            if (!professor || !turma || alunosSelecionados.length === 0 || !dataOcorrencia || irregularidades.length === 0 || !descricao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Dados para enviar para a planilha
            const dados = {
                data: dataOcorrencia,
                professor: professor,
                turma: turma,
                alunos: alunosSelecionados.join(', '),
                irregularidades: irregularidades.join(', '),
                descricao: descricao
            };
            
            // Simulação de envio para o Google Apps Script
            console.log('Dados da ocorrência (Professor):', dados);
            
            // Aqui você faria a chamada real para o Google Apps Script
            // fetch(SCRIPT_URL, {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     body: JSON.stringify({
            //         action: 'cadastrarOcorrenciaProfessor',
            //         spreadsheetId: SPREADSHEET_ID,
            //         data: dados
            //     })
            // })
            
            // Mostrar mensagem de sucesso
            document.getElementById('professorSuccessMessage').style.display = 'block';
            
            // Limpar formulário após 2 segundos
            setTimeout(() => {
                document.getElementById('professorSuccessMessage').style.display = 'none';
                document.getElementById('professorNome').value = '';
                document.getElementById('professorTurma').value = '';
                document.getElementById('dataOcorrencia').value = '';
                document.querySelectorAll('input[name="irregularidades"]:checked').forEach(input => {
                    input.checked = false;
                });
                document.getElementById('descricaoOcorrencia').value = '';
                
                // Limpar alunos selecionados
                alunosSelecionados = [];
                document.getElementById('selectedStudents').innerHTML = '';
            }, 2000);
        }

        // Gerar PDF
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adicionar título
            doc.setFontSize(18);
            doc.text('Registro de Ocorrência', 105, 15, { align: 'center' });
            
            // Adicionar dados do aluno se disponíveis
            if (currentAlunoData) {
                doc.setFontSize(12);
                doc.text(`Aluno: ${currentAlunoData.nome}`, 20, 30);
                doc.text(`Turma: ${currentAlunoData.turma}`, 20, 40);
                doc.text(`RA: ${currentAlunoData.ra}`, 20, 50);
            }
            
            // Adicionar data e hora
            const now = new Date();
            doc.text(`Data do registro: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`, 20, 60);
            
            // Criar nome do arquivo
            const fileName = `ocorrencia_${now.getTime()}.pdf`;
            
            // Baixar o PDF
            doc.save(fileName);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual como padrão para o campo de data da ocorrência (professor)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dataOcorrencia').value = today;
            
            // Fechar modal ao clicar fora dele
            window.onclick = function(event) {
                const modal = document.getElementById('alunosModal');
                if (event.target == modal) {
                    fecharModalAlunos();
                }
            };
            
            // Ajustar largura dos campos com base no conteúdo
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.width = '100%';
                    this.style.minWidth = '200px';
                });
                
                input.addEventListener('blur', function() {
                    this.style.width = '100%';
                });
            });
        });
    </script>
</body>
</html>
