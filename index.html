<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema de Ocorr√™ncias Escolares - 2025</title>
  
  <!-- jsPDF para gera√ß√£o local de PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ===== RESET E BASE ===== */
    *, *::before, *::after { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    html, body { 
      height: 100%; 
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #e6f2ff 0%, #e6ffe6 60%, #e6f9ff 100%);
      color: #333;
      font-weight: 500;
      padding: 20px;
      line-height: 1.6;
    }

    /* ===== LAYOUT PRINCIPAL ===== */
    .app {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-height: calc(100vh - 40px);
    }

    /* ===== HEADER ===== */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 32px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(0,31,63,0.95) 0%, rgba(0,78,120,0.95) 100%);
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    header h1 {
      font-size: 24px;
      margin: 0;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      font-weight: 700;
    }
    
    .header-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    #userDisplay {
      color: rgba(255,255,255,0.9);
      font-size: 14px;
      font-weight: 500;
      padding: 8px 12px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    /* ===== CARDS ===== */
    .card {
      background: #fff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
      position: relative;
      transition: all 0.3s ease;
    }

    /* ===== LAYOUT FLEX√çVEL ===== */
    .flex-row {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    
    .flex-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* ===== SE√á√ïES DE FORMUL√ÅRIO ===== */
    .form-section {
      background: linear-gradient(145deg, #f8f9fa 0%, #f1f3f4 100%);
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.06),
        0 4px 12px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.08);
    }

    /* ===== ELEMENTOS DE FORMUL√ÅRIO ===== */
    label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 2px solid #e5e7eb;
      font-size: 14px;
      color: #374151;
      background-color: #ffffff;
      transition: all 0.3s ease;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 
        0 0 0 3px rgba(59, 130, 246, 0.1),
        inset 0 1px 3px rgba(0,0,0,0.1);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    /* ===== BOT√ïES ===== */
    button {
      cursor: pointer;
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: #fff;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }
    
    .btn-success:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: #fff;
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(107, 114, 128, 0.4);
    }

    /* ===== ELEMENTOS DE TEXTO ===== */
    .subtitle {
      font-size: 20px;
      color: #1f2937;
      margin-bottom: 16px;
      font-weight: 700;
      padding-bottom: 12px;
      border-bottom: 3px solid #3b82f6;
    }

    /* ===== OP√á√ïES DE LOGIN ===== */
    .login-options {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }

    .login-option {
      flex: 1;
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      cursor: pointer;
      background: rgba(255,255,255,0.3);
      border: 2px solid transparent;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      font-weight: 600;
    }

    .login-option.active {
      background: linear-gradient(135deg, rgba(59,130,246,0.9) 0%, rgba(29,78,216,0.9) 100%);
      color: #fff;
      border-color: rgba(255,255,255,0.3);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
      transform: translateY(-2px);
    }

    .login-option:hover:not(.active) {
      background: rgba(255,255,255,0.5);
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }

    .access-area {
      display: none;
    }

    .access-area.active {
      display: block;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      align-items: flex-start;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    /* ===== CHECKBOXES ===== */
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin: 14px 0;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
      padding: 12px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.05);
    }

    .checkbox-item:hover {
      background: linear-gradient(145deg, #e2e8f0 0%, #cbd5e1 100%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-1px);
    }

    .checkbox-item input {
      margin-right: 10px;
      transform: scale(1.2);
    }

    /* ===== SELETOR DE ALUNOS ===== */
    .student-selector {
      padding: 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      min-height: 52px;
      display: flex;
      align-items: center;
    }

    .student-selector:hover {
      background: #f8fafc;
      border-color: #3b82f6;
      box-shadow: 
        inset 0 1px 4px rgba(0,0,0,0.1),
        0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }

    /* ===== PILLS ===== */
    .pill {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      display: inline-block;
      margin: 0 8px 8px 0;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    /* ===== MODAL ===== */
    .modal-root {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.6);
      z-index: 2000;
    }

    .modal {
      width: 92%;
      max-width: 800px;
      background: #fff;
      color: #374151;
      border-radius: 16px;
      padding: 28px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .studentList {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .student-checkbox {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 8px;
      margin-bottom: 4px;
    }

    .student-checkbox:hover {
      background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 100%);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
    }

    .student-checkbox input[type="checkbox"] {
      margin-right: 16px;
      transform: scale(1.3);
    }

    /* ===== HIST√ìRICO ===== */
    .historyList {
      max-height: 450px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding-right: 8px;
    }

    .historyItem {
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      border-left: 4px solid #3b82f6;
      padding: 20px;
      border-radius: 12px;
      color: #374151;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: all 0.2s ease;
      border: 1px solid rgba(0,0,0,0.05);
    }

    .historyItem .meta {
      font-size: 14px;
      color: #6b7280;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .historyItem .desc {
      margin-top: 12px;
      color: #4b5563;
      font-weight: 400;
      font-size: 14px;
      line-height: 1.6;
    }

    .history-controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ===== MENSAGEM DE SUCESSO ===== */
    .success-message {
      display: none;
      margin-top: 16px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      padding: 16px 20px;
      border-radius: 10px;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* ===== LOADER ===== */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loader {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(59, 130, 246, 0.2);
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    .muted {
      opacity: 0.7;
      font-weight: 500;
      color: #6b7280;
    }

    .qnum {
      color: #ef4444;
      font-weight: 700;
      font-family: 'Courier New', monospace;
    }

    /* ===== RESPONSIVIDADE ===== */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      .app {
        gap: 16px;
      }
      
      header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
        padding: 20px;
      }
      
      .login-options {
        flex-direction: column;
        gap: 12px;
      }
      
      .card {
        padding: 20px;
      }
      
      .form-section {
        padding: 20px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 16px;
      }
      
      .modal {
        width: 95%;
        padding: 20px;
        margin: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- ===== HEADER ===== -->
    <header>
      <h1>üìö Sistema de Ocorr√™ncias Escolares 2025</h1>
      <div class="header-controls">
        <div id="userDisplay" class="muted">N√£o autenticado</div>
        <button id="btnLogout" class="btn-danger" style="display:none" onclick="logout()">
          Sair
        </button>
        <button id="btnDownloadPdf" class="btn-success" style="display:none" onclick="downloadDocument()">
          üìÑ Template
        </button>
      </div>
    </header>

    <!-- ===== TELA DE LOGIN ===== -->
    <div id="loginScreen" class="card" style="display:block">
      <div style="max-width:600px;margin:0 auto">
        <div class="subtitle">üîê Selecione o tipo de acesso</div>

        <div class="login-options">
          <div class="login-option active" id="optionGestao" onclick="selectLoginOption('gestao')">
            <div style="font-size: 24px; margin-bottom: 8px;">üë•</div>
            <div>Acesso Gest√£o</div>
            <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">
              Registro completo e relat√≥rios
            </div>
          </div>
          <div class="login-option" id="optionProfessor" onclick="selectLoginOption('professor')">
            <div style="font-size: 24px; margin-bottom: 8px;">üë®‚Äçüè´</div>
            <div>Acesso Professor</div>
            <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">
              Registro de ocorr√™ncias
            </div>
          </div>
        </div>

        <!-- Formul√°rio de Login - Gest√£o -->
        <div id="loginFormGestao" class="access-area active">
          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label for="emailGestao">üìß E-mail da Gest√£o</label>
                <input id="emailGestao" type="email" placeholder="gestao@escola.com" autocomplete="username">
              </div>
              <div class="field-group">
                <label for="passwordGestao">üîí Senha</label>
                <input id="passwordGestao" type="password" placeholder="Digite sua senha" autocomplete="current-password">
              </div>
            </div>
          </div>

          <div class="flex-row">
            <button class="btn-primary" onclick="login('gestao')">
              üöÄ Entrar como Gest√£o
            </button>
            <button class="btn-secondary" onclick="fillDemo('gestao')">
              üéØ Dados Demo
            </button>
          </div>
        </div>

        <!-- Formul√°rio de Login - Professor -->
        <div id="loginFormProfessor" class="access-area">
          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label for="emailProfessor">üìß E-mail do Professor</label>
                <input id="emailProfessor" type="email" placeholder="professor@escola.com" autocomplete="username">
              </div>
              <div class="field-group">
                <label for="passwordProfessor">üîí Senha</label>
                <input id="passwordProfessor" type="password" placeholder="Digite sua senha" autocomplete="current-password">
              </div>
            </div>
          </div>

          <div class="flex-row">
            <button class="btn-primary" onclick="login('professor')">
              üöÄ Entrar como Professor
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== APLICA√á√ÉO PRINCIPAL - GEST√ÉO ===== -->
    <div id="mainAppGestao" style="display:none;flex-direction:column;gap:20px">
      <div class="flex-row">
        <!-- Formul√°rio de Cadastro - Gest√£o -->
        <div class="card flex-col" style="flex:1">
          <div class="subtitle">üìù Cadastro de Ocorr√™ncia - Gest√£o</div>

          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label>üè´ S√©rie / Turma</label>
                <select id="serie_gestao" onchange="carregarAlunosPorTurmaGestao(this.value)">
                  <option value="">Selecione a turma</option>
                  <option value="6¬∞ ANO A MANHA">6¬∞ ANO A MANH√É</option>
                  <option value="6¬∞ ANO B MANHA">6¬∞ ANO B MANH√É</option>
                  <option value="6¬∞ ANO C MANHA">6¬∞ ANO C MANH√É</option>
                  <option value="6¬∞ ANO D MANHA">6¬∞ ANO D MANH√É</option>
                  <option value="6¬∞ ANO E TARDE">6¬∞ ANO E TARDE</option>
                  <option value="6¬∞ ANO F TARDE">6¬∞ ANO F TARDE</option>
                  <option value="7¬∞ ANO A TARDE">7¬∞ ANO A TARDE</option>
                  <option value="7¬∞ ANO B TARDE">7¬∞ ANO B TARDE</option>
                  <option value="7¬∞ ANO C TARDE">7¬∞ ANO C TARDE</option>
                  <option value="7¬∞ ANO D TARDE">7¬∞ ANO D TARDE</option>
                  <option value="7¬∞ ANO E TARDE">7¬∞ ANO E TARDE</option>
                  <option value="7¬∞ ANO F TARDE">7¬∞ ANO F TARDE</option>
                  <option value="8¬∞ ANO A TARDE">8¬∞ ANO A TARDE</option>
                  <option value="8¬∞ ANO B TARDE">8¬∞ ANO B TARDE</option>
                  <option value="8¬∞ ANO C TARDE">8¬∞ ANO C TARDE</option>
                  <option value="8¬∞ ANO D TARDE">8¬∞ ANO D TARDE</option>
                  <option value="9¬∞ ANO A TARDE">9¬∞ ANO A TARDE</option>
                  <option value="9¬∞ ANO B TARDE">9¬∞ ANO B TARDE</option>
                  <option value="9¬∞ ANO C TARDE">9¬∞ ANO C TARDE</option>
                  <option value="9¬∞ ANO D TARDE">9¬∞ ANO D TARDE</option>
                  <option value="1¬™ SERIE A MANHA">1¬™ S√âRIE A MANH√É</option>
                  <option value="1¬™ SERIE B MANHA">1¬™ S√âRIE B MANH√É</option>
                  <option value="1¬™ SERIE C MANHA">1¬™ S√âRIE C MANH√É</option>
                  <option value="1¬™ SERIE D MANHA">1¬™ S√âRIE D MANH√É</option>
                  <option value="1¬™ SERIE E MANHA">1¬™ S√âRIE E MANH√É</option>
                  <option value="1¬™ SERIE F MANHA">1¬™ S√âRIE F MANH√É</option>
                  <option value="1¬™ SERIE G TARDE">1¬™ S√âRIE G TARDE</option>
                  <option value="1¬™ SERIE H NOITE">1¬™ S√âRIE H NOITE</option>
                  <option value="1¬™ SERIE I NOITE">1¬™ S√âRIE I NOITE</option>
                  <option value="2¬™ SERIE A MANHA">2¬™ S√âRIE A MANH√É</option>
                  <option value="2¬™ SERIE B MANHA">2¬™ S√âRIE B MANH√É</option>
                  <option value="2¬™ SERIE C MANHA">2¬™ S√âRIE C MANH√É</option>
                  <option value="2¬™ SERIE D MANHA">2¬™ S√âRIE D MANH√É</option>
                  <option value="2¬™ SERIE E MANHA">2¬™ S√âRIE E MANH√É</option>
                  <option value="2¬™ SERIE F NOITE">2¬™ S√âRIE F NOITE</option>
                  <option value="2¬™ SERIE G NOITE">2¬™ S√âRIE G NOITE</option>
                  <option value="2¬™ SERIE H NOITE">2¬™ S√âRIE H NOITE</option>
                  <option value="3¬™ SERIE A MANHA">3¬™ S√âRIE A MANH√É</option>
                  <option value="3¬™ SERIE B MANHA">3¬™ S√âRIE B MANH√É</option>
                  <option value="3¬™ SERIE C MANHA">3¬™ S√âRIE C MANH√É</option>
                  <option value="3¬™ SERIE D NOITE">3¬™ S√âRIE D NOITE</option>
                  <option value="3¬™ SERIE E NOITE">3¬™ S√âRIE E NOITE</option>
                  <option value="3¬™ SERIE F NOITE">3¬™ S√âRIE F NOITE</option>
                  <option value="3¬™ SERIE G NOITE">3¬™ S√âRIE G NOITE</option>
                </select>
              </div>

              <div class="field-group">
                <label>üë• Aluno(s)</label>
                <div class="student-selector" onclick="openStudentsModalGestao()">
                  <span id="aluno_gestao_placeholder">Selecione a turma e depois clique para escolher os alunos</span>
                </div>
                <div id="selectedPillsGestao" style="margin-top:12px"></div>
              </div>
            </div>

            <div class="form-row">
              <div class="field-group">
                <label>üÜî RA(s)</label>
                <input id="ra_gestao" type="text" readonly placeholder="RAs ser√£o preenchidos automaticamente">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label>üë®‚Äçüè´ Professor</label>
                <input id="professor_gestao" type="text" placeholder="Nome do professor">
              </div>
              <div class="field-group">
                <label>üìö Disciplina</label>
                <input id="disciplina_gestao" type="text" placeholder="Nome da disciplina">
              </div>
            </div>

            <div class="form-row">
              <div class="field-group">
                <label>‚ö†Ô∏è Classifica√ß√£o</label>
                <select id="classificacao_gestao" onchange="toggleSuspension('gestao')">
                  <option value="">Selecione a classifica√ß√£o</option>
                  <option value="ADVERT√äNCIA VERBAL">ADVERT√äNCIA VERBAL</option>
                  <option value="ADVERT√äNCIA ESCRITA">ADVERT√äNCIA ESCRITA</option>
                  <option value="SUSPENS√ÉO">SUSPENS√ÉO</option>
                  <option value="OUTROS">OUTROS</option>
                </select>
              </div>
            </div>

            <div id="suspensionRow_gestao" class="form-row" style="display:none">
              <div class="field-group">
                <label>üìÖ Data de Retorno (Suspens√£o)</label>
                <input id="dataRetorno_gestao" type="date" class="date-field">
              </div>
            </div>

            <div class="form-row">
              <div class="field-group">
                <label>üìù Descri√ß√£o da Ocorr√™ncia</label>
                <textarea id="descricao_gestao" placeholder="Descreva detalhadamente a ocorr√™ncia..."></textarea>
              </div>
            </div>
          </div>

          <div class="flex-row">
            <button class="btn-primary" onclick="cadastrarOcorrenciaGestao()">
              üíæ Registrar Ocorr√™ncia
            </button>
            <button class="btn-secondary" onclick="clearGestaoForm()">
              üîÑ Limpar Formul√°rio
            </button>
            <button class="btn-success" onclick="generatePDFLocal()">
              üìÑ Gerar PDF Local
            </button>
          </div>

          <div id="successGestao" class="success-message">
            ‚úÖ Ocorr√™ncia registrada com sucesso!
          </div>
        </div>

        <!-- Hist√≥rico - Gest√£o -->
        <div class="card flex-col" style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
            <div class="subtitle">üìã Hist√≥rico de Ocorr√™ncias - Gest√£o</div>
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
              <button class="btn-primary" onclick="carregarHistoricoGestao()">
                üîÑ Atualizar
              </button>
            </div>
          </div>
          <div id="historyListGestao" class="historyList"></div>
        </div>
      </div>
    </div>

    <!-- ===== APLICA√á√ÉO PRINCIPAL - PROFESSOR ===== -->
    <div id="mainAppProfessor" style="display:none;flex-direction:column;gap:20px">
      <div class="flex-row">
        <!-- Formul√°rio de Cadastro - Professor -->
        <div class="card flex-col" style="flex:1">
          <div class="subtitle">üìù Cadastro de Ocorr√™ncia - Professor</div>

          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label>üë®‚Äçüè´ Professor</label>
                <select id="professor_select">
                  <option value="">-- selecione professor --</option>
                </select>
              </div>
              <div class="field-group">
                <label>üè´ Turma</label>
                <select id="turma_select" onchange="onTurmaChange()">
                  <option value="">-- selecione turma --</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="field-group">
                <label>üìÖ Data da Ocorr√™ncia</label>
                <input id="data_prof" type="date" class="date-field">
              </div>
              <div class="field-group">
                <label>üë• Aluno(s)</label>
                <div class="student-selector" onclick="openStudentsModal()">
                  <span id="alunos_selected_placeholder">Clique para selecionar</span>
                </div>
                <div id="selectedPills" style="margin-top:12px"></div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <label>‚ö†Ô∏è Irregularidades (selecione uma ou mais)</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="Falta de respeito" id="irreg1">
                <label for="irreg1">Falta de respeito</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="N√£o fez a atividade" id="irreg2">
                <label for="irreg2">N√£o fez a atividade</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="Conversas paralelas" id="irreg3">
                <label for="irreg3">Conversas paralelas</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="Uso de celular" id="irreg4">
                <label for="irreg4">Uso de celular</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="Atraso" id="irreg5">
                <label for="irreg5">Atraso</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" name="irreg" value="Sa√≠da sem autoriza√ß√£o" id="irreg6">
                <label for="irreg6">Sa√≠da sem autoriza√ß√£o</label>
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-row">
              <div class="field-group">
                <label>üìù Descri√ß√£o Adicional (opcional)</label>
                <textarea id="descricao_prof" placeholder="Informa√ß√µes adicionais sobre a ocorr√™ncia..."></textarea>
              </div>
            </div>
          </div>

          <div class="flex-row">
            <button class="btn-primary" onclick="registrarOcorrenciaProfessor()">
              üíæ Registrar Ocorr√™ncia
            </button>
            <button class="btn-secondary" onclick="clearProfessorForm()">
              üîÑ Limpar Formul√°rio
            </button>
          </div>

          <div id="successProfessor" class="success-message">
            ‚úÖ Ocorr√™ncia registrada com sucesso!
          </div>
        </div>

        <!-- Hist√≥rico - Professor -->
        <div class="card flex-col" style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
            <div class="subtitle">üìã Hist√≥rico de Ocorr√™ncias - Professor</div>
            <div style="display:flex;gap:12px;align-items:center">
              <button class="btn-primary" onclick="carregarHistoricoProfessor()">
                üîÑ Atualizar
              </button>
            </div>
          </div>
          <div id="historyListProfessor" class="historyList"></div>
        </div>
      </div>
    </div>

    <!-- ===== MODAL SELE√á√ÉO ALUNOS - PROFESSOR ===== -->
    <div id="modalRoot" class="modal-root">
      <div class="modal">
        <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
          <strong style="font-size:18px">üë• Selecionar Alunos</strong>
          <button onclick="closeStudentsModal()" style="background:transparent;border:none;font-weight:700;cursor:pointer;font-size:24px;color:#6b7280;padding:4px">‚úï</button>
        </header>

        <div>
          <input id="studentSearch" type="text" placeholder="üîç Filtrar alunos..." style="width:100%;padding:14px;border-radius:10px;border:2px solid #e5e7eb;margin-bottom:20px" oninput="filterStudentList()">
          <div id="studentList" class="studentList"></div>
        </div>

        <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:20px;flex-wrap:wrap">
          <button class="btn-primary" onclick="confirmStudents()">
            ‚úÖ Confirmar Sele√ß√£o
          </button>
          <button class="btn-secondary" onclick="closeStudentsModal()">
            ‚ùå Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- ===== MODAL SELE√á√ÉO ALUNOS - GEST√ÉO ===== -->
    <div id="modalRootGestao" class="modal-root">
      <div class="modal">
        <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
          <strong style="font-size:18px">üë• Selecionar Alunos</strong>
          <button onclick="closeStudentsModalGestao()" style="background:transparent;border:none;font-weight:700;cursor:pointer;font-size:24px;color:#6b7280;padding:4px">‚úï</button>
        </header>

        <div>
          <input id="studentSearchGestao" type="text" placeholder="üîç Filtrar alunos..." style="width:100%;padding:14px;border-radius:10px;border:2px solid #e5e7eb;margin-bottom:20px" oninput="filterStudentListGestao()">
          <div id="studentListGestao" class="studentList"></div>
        </div>

        <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:20px;flex-wrap:wrap">
          <button class="btn-primary" onclick="confirmStudentsGestao()">
            ‚úÖ Confirmar Sele√ß√£o
          </button>
          <button class="btn-secondary" onclick="closeStudentsModalGestao()">
            ‚ùå Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*******************************
     * CONFIGURA√á√ïES
     *******************************/
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyC1mPAlo45Wb43-ijrMI_8khedNZaC9hOXaQ8tFZwJ5ytAqpsoSX21ay1jHQb8PrML/exec';
    const SPREADSHEET_ID = '1u7qMsMHkZT47OZdar5qvshQDRA8XJrLgDjAZVOViAio';

    // Planilha SharePoint (Excel) para professor
    const SHAREPOINT_ID = 'EdAMsLnS0k9Bia-6V5c2UOwBXGopV6LDzvy3yo87v61rkw?e=XZs4hP';
    const SHAREPOINT_URL = `https://seducsp-my.sharepoint.com/:x:/g/personal/e923357w10_professor_educacao_sp_gov_br/${SHAREPOINT_ID}`;

    // Template PDF
    const PDF_TEMPLATE_URL = 'https://docs.google.com/document/d/1dHwyN8mlb_4bltEksnoc3Yx5wUcDNgAkzqsluLPYeP8/edit?tab=t.0';

    // Nomes de abas (front-end manda "sheet" para o Apps Script)
    const SHEET_GERAL = 'BANCODEDADOSGERAL';
    const SHEET_PROF = 'OCORRENCIASDOSPROFESSORES';
    const SHEET_GESTAO = 'BANCODEALUNOS';

    // Estado da aplica√ß√£o
    let allAlunos = [];
    let alunosDaTurmaAtual = [];
    let alunosSelecionados = [];
    let alunosDaTurmaAtualGestao = [];
    let alunosSelecionadosGestao = [];
    let professores = [];
    let turmas = [];
    let currentUserRole = null;

    /*******************************
     * INICIALIZA√á√ÉO
     *******************************/
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Sistema iniciando...');
      
      try {
        // Define data atual
        const today = new Date().toISOString().split('T')[0];
        const dataProfField = document.getElementById('data_prof');
        if (dataProfField) {
          dataProfField.value = today;
        }

        // Inicializa com gest√£o selecionada
        selectLoginOption('gestao');
        
        console.log('Sistema inicializado com sucesso!');
      } catch (error) {
        console.error('Erro na inicializa√ß√£o:', error);
        alert('Erro ao inicializar o sistema. Recarregue a p√°gina.');
      }
    });

    /*******************************
     * FUN√á√ïES DE LOGIN
     *******************************/
    function selectLoginOption(role) {
      console.log('Selecionando op√ß√£o de login:', role);
      
      try {
        // Remove classe active de todas as op√ß√µes
        const allOptions = document.querySelectorAll('.login-option');
        allOptions.forEach(opt => opt.classList.remove('active'));
        
        // Adiciona classe active na op√ß√£o selecionada
        const selectedOption = document.getElementById(`option${role.charAt(0).toUpperCase() + role.slice(1)}`);
        if (selectedOption) {
          selectedOption.classList.add('active');
        }

        // Esconde todas as √°reas de acesso
        const allAreas = document.querySelectorAll('.access-area');
        allAreas.forEach(area => {
          area.classList.remove('active');
          area.style.display = 'none';
        });
        
        // Mostra a √°rea de acesso selecionada
        const selectedArea = document.getElementById(`loginForm${role.charAt(0).toUpperCase() + role.slice(1)}`);
        if (selectedArea) {
          selectedArea.classList.add('active');
          selectedArea.style.display = 'block';
        }
        
        console.log('Op√ß√£o de login selecionada com sucesso:', role);
      } catch (error) {
        console.error('Erro ao selecionar op√ß√£o de login:', error);
        alert('Erro ao alternar tipo de login');
      }
    }

    function login(role) {
      console.log('Tentando fazer login como:', role);
      
      try {
        const email = document.getElementById(`email${role.charAt(0).toUpperCase() + role.slice(1)}`).value.trim();
        const password = document.getElementById(`password${role.charAt(0).toUpperCase() + role.slice(1)}`).value.trim();

        if (!email || !password) {
          alert('Por favor, preencha e-mail e senha');
          return;
        }

        // Valida√ß√£o de credenciais (demo)
        if ((role === 'gestao' && email === 'gestao@escola.com' && password === 'gestao123') ||
            (role === 'professor' && email === 'professor@escola.com' && password === 'prof123')) {
            
            console.log('Login bem-sucedido para:', role);
            showAppAs(role, email);
        } else {
          alert('E-mail ou senha incorretos');
        }
      } catch (error) {
        console.error('Erro no login:', error);
        alert('Erro interno no processo de login');
      }
    }

    function fillDemo(role) {
      try {
        if (role === 'gestao') {
          document.getElementById('emailGestao').value = 'gestao@escola.com';
          document.getElementById('passwordGestao').value = 'gestao123';
          console.log('Dados de demonstra√ß√£o preenchidos');
        }
      } catch (error) {
        console.error('Erro ao preencher demo:', error);
      }
    }

    function showAppAs(role, email) {
      console.log('Mostrando aplica√ß√£o para:', role);
      
      try {
        currentUserRole = role;
        
        // Esconde tela de login
        document.getElementById('loginScreen').style.display = 'none';
        
        // Atualiza header
        document.getElementById('userDisplay').textContent = `${email} (${role.charAt(0).toUpperCase() + role.slice(1)})`;
        document.getElementById('btnLogout').style.display = 'inline-block';
        document.getElementById('btnDownloadPdf').style.display = 'inline-block';

        if (role === 'gestao') {
          document.getElementById('mainAppGestao').style.display = 'flex';
          document.getElementById('mainAppProfessor').style.display = 'none';
          
          // Carrega dados iniciais para gest√£o
          carregarTodosAlunos();
          carregarHistoricoGestao();
        } else {
          document.getElementById('mainAppGestao').style.display = 'none';
          document.getElementById('mainAppProfessor').style.display = 'flex';
          
          // Carrega dados iniciais para professor
          carregarProfessoresETurmas();
          carregarHistoricoProfessor();
        }
        
        console.log('Aplica√ß√£o exibida com sucesso para:', role);
      } catch (error) {
        console.error('Erro ao exibir aplica√ß√£o:', error);
        alert('Erro ao carregar dados iniciais');
      }
    }

    function logout() {
      console.log('Fazendo logout...');
      
      try {
        currentUserRole = null;
        
        // Mostra tela de login
        document.getElementById('loginScreen').style.display = 'block';
        
        // Esconde aplica√ß√µes
        document.getElementById('mainAppGestao').style.display = 'none';
        document.getElementById('mainAppProfessor').style.display = 'none';
        
        // Atualiza header
        document.getElementById('userDisplay').textContent = 'N√£o autenticado';
        document.getElementById('btnLogout').style.display = 'none';
        document.getElementById('btnDownloadPdf').style.display = 'none';

        // Limpa formul√°rios
        ['emailGestao', 'passwordGestao', 'emailProfessor', 'passwordProfessor'].forEach(id => {
          const element = document.getElementById(id);
          if (element) element.value = '';
        });
        
        // Limpa estado
        clearProfessorForm();
        clearGestaoForm();
        
        console.log('Logout realizado com sucesso');
      } catch (error) {
        console.error('Erro no logout:', error);
        alert('Erro ao fazer logout');
      }
    }

    /*******************************
     * FUN√á√ïES AUXILIARES
     *******************************/
    function clearProfessorForm() {
      try {
        const elements = ['professor_select', 'turma_select', 'descricao_prof'];
        elements.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.value = '';
        });
        
        document.querySelectorAll('input[name="irreg"]').forEach(cb => cb.checked = false);
        
        const dataField = document.getElementById('data_prof');
        if (dataField) {
          dataField.value = new Date().toISOString().split('T')[0];
        }
        
        alunosSelecionados = [];
        renderSelectedPills();
        
        const placeholder = document.getElementById('alunos_selected_placeholder');
        if (placeholder) {
          placeholder.textContent = "Clique para selecionar";
        }
      } catch (error) {
        console.error('Erro ao limpar formul√°rio do professor:', error);
      }
    }

    function clearGestaoForm() {
      try {
        const elements = ['serie_gestao', 'professor_gestao', 'disciplina_gestao', 'classificacao_gestao', 'descricao_gestao'];
        elements.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.value = '';
        });
        
        const suspensionRow = document.getElementById('suspensionRow_gestao');
        if (suspensionRow) {
          suspensionRow.style.display = 'none';
        }
        
        alunosSelecionadosGestao = [];
        renderSelectedPillsGestao();
        updateRAsGestao();
        
        const placeholder = document.getElementById('aluno_gestao_placeholder');
        if (placeholder) {
          placeholder.textContent = "Selecione a turma e depois clique para escolher os alunos";
        }
      } catch (error) {
        console.error('Erro ao limpar formul√°rio da gest√£o:', error);
      }
    }

    function renderSelectedPills() {
      try {
        const pillsContainer = document.getElementById('selectedPills');
        if (!pillsContainer) return;
        
        pillsContainer.innerHTML = '';
        alunosSelecionados.forEach(nome => {
          const pill = document.createElement('div');
          pill.className = 'pill';
          pill.textContent = nome;
          pillsContainer.appendChild(pill);
        });
      } catch (error) {
        console.error('Erro ao renderizar pills:', error);
      }
    }

    function renderSelectedPillsGestao() {
      try {
        const pillsContainer = document.getElementById('selectedPillsGestao');
        if (!pillsContainer) return;
        
        pillsContainer.innerHTML = '';
        alunosSelecionadosGestao.forEach(nome => {
          const pill = document.createElement('div');
          pill.className = 'pill';
          pill.textContent = nome;
          pillsContainer.appendChild(pill);
        });
      } catch (error) {
        console.error('Erro ao renderizar pills (gest√£o):', error);
      }
    }

    function updateRAsGestao() {
      try {
        const ras = alunosDaTurmaAtualGestao
          .filter(item => alunosSelecionadosGestao.includes(item.nome) && item.ra)
          .map(item => item.ra);
        
        const raField = document.getElementById('ra_gestao');
        if (raField) {
          raField.value = ras.join(', ');
        }
      } catch (error) {
        console.error('Erro ao atualizar RAs:', error);
      }
    }

    function toggleSuspension(area) {
      try {
        if (area === 'gestao') {
          const val = document.getElementById('classificacao_gestao').value;
          const suspensionRow = document.getElementById('suspensionRow_gestao');
          if (suspensionRow) {
            suspensionRow.style.display = (val === 'SUSPENS√ÉO') ? 'flex' : 'none';
          }
        }
      } catch (error) {
        console.error('Erro ao alternar suspens√£o:', error);
      }
    }

    /*******************************
     * FUN√á√ïES PLACEHOLDER (para evitar erros)
     *******************************/
    function carregarProfessoresETurmas() {
      console.log('Carregando professores e turmas...');
      // Implementa√ß√£o simplificada para evitar erros
      professores = ['Prof. Ana Silva', 'Prof. Carlos Santos', 'Prof. Maria Oliveira'];
      turmas = ['6¬∞ ANO A MANHA', '6¬∞ ANO B MANHA', '7¬∞ ANO A TARDE'];
      
      populateSelect('professor_select', professores, '-- selecione professor --');
      populateSelect('turma_select', turmas, '-- selecione turma --');
    }

    function carregarTodosAlunos() {
      console.log('Carregando todos os alunos...');
      // Implementa√ß√£o simplificada
      allAlunos = [
        {nome: 'Jo√£o Silva', turma: '6¬∞ ANO A MANHA'},
        {nome: 'Maria Santos', turma: '6¬∞ ANO A MANHA'},
        {nome: 'Pedro Oliveira', turma: '6¬∞ ANO B MANHA'}
      ];
    }

    function carregarHistoricoGestao() {
      console.log('Carregando hist√≥rico da gest√£o...');
      const container = document.getElementById('historyListGestao');
      if (container) {
        container.innerHTML = '<div class="muted">Nenhuma ocorr√™ncia encontrada.</div>';
      }
    }

    function carregarHistoricoProfessor() {
      console.log('Carregando hist√≥rico do professor...');
      const container = document.getElementById('historyListProfessor');
      if (container) {
        container.innerHTML = '<div class="muted">Nenhuma ocorr√™ncia encontrada.</div>';
      }
    }

    function onTurmaChange() {
      console.log('Turma alterada');
      // Implementa√ß√£o simplificada
    }

    function carregarAlunosPorTurmaGestao(turma) {
      console.log('Carregando alunos para turma:', turma);
      // Implementa√ß√£o simplificada
      if (turma) {
        alunosDaTurmaAtualGestao = [
          {nome: 'Jo√£o Silva', ra: '12345'},
          {nome: 'Maria Santos', ra: '12346'}
        ];
        const placeholder = document.getElementById('aluno_gestao_placeholder');
        if (placeholder) {
          placeholder.textContent = "Clique para selecionar os alunos";
        }
      }
    }

    function populateSelect(selectId, options, placeholder) {
      try {
        const select = document.getElementById(selectId);
        if (!select) return;
        
        select.innerHTML = `<option value="">${placeholder}</option>`;
        options.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt;
          option.textContent = opt;
          select.appendChild(option);
        });
      } catch (error) {
        console.error('Erro ao popular select:', error);
      }
    }

    function openStudentsModal() {
      alert('Modal de sele√ß√£o de alunos (em desenvolvimento)');
    }

    function openStudentsModalGestao() {
      alert('Modal de sele√ß√£o de alunos para gest√£o (em desenvolvimento)');
    }

    function closeStudentsModal() {
      const modal = document.getElementById('modalRoot');
      if (modal) modal.style.display = 'none';
    }

    function closeStudentsModalGestao() {
      const modal = document.getElementById('modalRootGestao');
      if (modal) modal.style.display = 'none';
    }

    function cadastrarOcorrenciaGestao() {
      alert('Fun√ß√£o de cadastro de ocorr√™ncia da gest√£o (em desenvolvimento)');
    }

    function registrarOcorrenciaProfessor() {
      alert('Fun√ß√£o de registro de ocorr√™ncia do professor (em desenvolvimento)');
    }

    function generatePDFLocal() {
      alert('Fun√ß√£o de gera√ß√£o de PDF local (em desenvolvimento)');
    }

    function downloadDocument() {
      window.open(PDF_TEMPLATE_URL, '_blank');
    }

    // Fun√ß√µes placeholder para evitar erros
    function confirmStudents() { closeStudentsModal(); }
    function confirmStudentsGestao() { closeStudentsModalGestao(); }
    function filterStudentList() { console.log('Filtrando alunos...'); }
    function filterStudentListGestao() { console.log('Filtrando alunos (gest√£o)...'); }

    console.log('JavaScript carregado com sucesso!');
  </script>
</body>
</html>
